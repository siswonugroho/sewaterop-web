document.addEventListener("DOMContentLoaded",(function(event){const segeraBerakhirList=document.querySelector(".segera-berakhir").querySelector(".list-group"),sewaTerbaruList=document.querySelector(".sewa-terbaru").querySelector(".list-group"),dt=luxon.DateTime;async function getListTop5(listElement,url){const noListElement=listElement.querySelector(".no-list");try{noListElement.classList.remove(".d-none");const response=await fetch(`${BASEURL}/home/${url}`);if(noListElement.classList.add("d-none"),!response.ok)throw Error();const responseJson=await response.json();if(!responseJson)throw Error();listElement==segeraBerakhirList?renderListSegeraBerakhir(responseJson):listElement==sewaTerbaruList&&renderListSewaTerbaru(responseJson),0===Object.keys(responseJson).length?(noListElement.textContent="Tidak ada data.",noListElement.classList.remove("d-none")):noListElement.classList.add("d-none")}catch(error){noListElement.textContent="Error: Tidak dapat memuat daftar.",noListElement.classList.remove("d-none")}}function renderListSegeraBerakhir(data){segeraBerakhirList.innerHTML="",data.forEach(item=>{segeraBerakhirList.insertAdjacentHTML("beforeend",`<a href="${BASEURL}/datasewaan/details/viewdetail/${item.id_pesanan}" class="list-group-item list-group-item-action">\n    <h5>${item.id_pesanan.toUpperCase()} - ${item.nama_pemesan}</h5>\n    <p class="text-secondary m-0">Berakhir <span class="days-text">${dateRangeToToday(item.tgl_selesai)} hari lagi</span></p>\n</a>`)});const daysText=segeraBerakhirList.querySelectorAll("span.days-text");daysText.forEach(text=>{const daysTextDigit=text.textContent.match(/\d+/g);0==daysTextDigit[0]?text.textContent="hari ini":1==daysTextDigit[0]&&(text.textContent="besok")})}function renderListSewaTerbaru(data){sewaTerbaruList.innerHTML="",data.forEach(item=>{sewaTerbaruList.insertAdjacentHTML("beforeend",`<a href="${BASEURL}/datasewaan/details/viewdetail/${item.id_pesanan}" class="list-group-item list-group-item-action">\n    <h5>${item.id_pesanan.toUpperCase()} - ${item.nama_pemesan}</h5>\n    <p class="text-secondary m-0">${formatDate(item.tgl_mulai,dt.DATE_MED)} - ${formatDate(item.tgl_selesai,dt.DATE_MED)}</p>\n</a>`)})}function dateRangeToToday(dateString){const end=dt.fromSQL(dateString),diffInDays=end.diffNow("days"),diffObj=diffInDays.toObject();return Math.floor(diffObj.days+1)}getListTop5(segeraBerakhirList,"getsewaakanberakhir"),getListTop5(sewaTerbaruList,"getsewaterbaru")}));