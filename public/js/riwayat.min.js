document.addEventListener("DOMContentLoaded",(function(event){const listRiwayatContainer=document.querySelector("div#list-riwayat-container"),listRiwayatLoading=listRiwayatContainer.querySelector("span#loading-list"),listRiwayatEmptyMessage=listRiwayatContainer.querySelector(".list-riwayat-empty-message"),listGroupElement=listRiwayatContainer.querySelector("div.list-group"),dialogDataElement=document.querySelectorAll(".selected-data"),checkboxBlmLunas=document.querySelector("input#filter-blm-lunas");function countDataRiwayat(listParent){const angkaText=document.querySelector("#total-riwayat");angkaText.innerText=listParent.children.length.toString()}async function getListRiwayat(){try{listRiwayatLoading.classList.remove("d-none");const response=await fetch(`${BASEURL}/datariwayat/getListRiwayat`);if(listRiwayatLoading.classList.add("d-none"),!response.ok)throw Error();const responseJson=await response.json();if(!responseJson)throw Error();if(renderListRiwayat(responseJson),countDataRiwayat(listGroupElement),0!==Object.keys(responseJson).length){toggleListEmpty("hide");const listRiwayat=new List("list-riwayat",{valueNames:["nama","last-added","status"]});listRiwayat.sort("last-added",{order:"desc"}),listRiwayat.on("searchComplete",(function(){0===listRiwayat.matchingItems.length?toggleListEmpty("show","search","Hasil pencarian tidak ditemukan","Coba masukkan kata kunci lain yang lebih umum."):toggleListEmpty("hide")})),checkBlmLunas(listRiwayat)}else toggleListEmpty("show","emoji-frown","Tidak ada riwayat disini","Semua transaksi sewaan yang sudah selesai akan tersimpan disini.")}catch(error){listRiwayatLoading.classList.add("d-none"),toggleListEmpty("show","x-circle","Gagal memuat daftar riwayat","Coba lagi nanti atau refresh halaman ini."),console.error(error)}}function renderListRiwayat(dataRiwayat){listGroupElement.innerHTML="",dataRiwayat.forEach(riwayat=>{listGroupElement.insertAdjacentHTML("beforeend",`\n<div class="list-group-item anim-fade">\n<div class="row">\n    <div class="col-8">\n    <h5>${riwayat.id_pesanan.toUpperCase()} - <span class="nama">${riwayat.nama_pemesan}</span></h5>\n    <p class="my-0 status">${riwayat.status_pembayaran}</p>\n    <p class="d-none last-added">${riwayat.id_pesanan}</p>\n    </div>\n    <div class="col-md my-2">\n    <a href="${BASEURL}/datariwayat/viewreport/${riwayat.id_pesanan}" class="btn btn-primary my-2 my-md-1 text-truncate view-report-btn">Lihat Struk</a>\n    <a data-toggle="modal" data-target="#dialogHapus" data-id-sewaan="${riwayat.id_pesanan}" data-id-paket="${riwayat.id_paket}" data-nama-penyewa="${riwayat.nama_pemesan}" class="btn btn-outline-danger my-2 my-md-1 text-truncate">Hapus</a>\n    </div>\n</div>\n</div>`)});const listGroupItem=listGroupElement.querySelectorAll(".list-group-item");listGroupItem.forEach(list=>{const statusPembayaranText=list.querySelector("p.status");statusPembayaranText.textContent.startsWith("L")?statusPembayaranText.classList.add("font-weight-bold","text-success"):statusPembayaranText.textContent.startsWith("K")&&statusPembayaranText.classList.add("font-weight-bold","text-danger")}),listGroupElement.querySelectorAll("a[data-toggle=modal]").forEach(btn=>{btn.addEventListener("click",(function(){dialogDataElement.forEach(element=>{"A"==element.tagName?element.setAttribute("href",`${BASEURL}/datariwayat/hapus/${btn.getAttribute("data-id-sewaan")}/${btn.getAttribute("data-id-paket")}`):element.textContent=btn.getAttribute("data-nama-penyewa")})}))})}function toggleListEmpty(toggle,iconName="",messageTitle="",messageDetail=""){switch(toggle){case"show":listRiwayatEmptyMessage.classList.replace("d-none","d-flex"),listRiwayatEmptyMessage.children[0].querySelector("use").setAttribute("href",`${BASEURL}/img/bootstrap-icons-1.2.1/bootstrap-icons.svg#${iconName}`),listRiwayatEmptyMessage.children[1].textContent=messageTitle,listRiwayatEmptyMessage.children[2].textContent=messageDetail;break;case"hide":listRiwayatEmptyMessage.classList.replace("d-flex","d-none")}}function checkBlmLunas(listObject){checkboxBlmLunas.checked?listObject.filter((function(items){return"Lunas"!=items.values().status})):listObject.filter()}document.querySelector("a#btn-refresh").addEventListener("click",(function(){getListRiwayat()})),checkboxBlmLunas.addEventListener("click",(function(){getListRiwayat()})),getListRiwayat()}));