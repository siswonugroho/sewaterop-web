/*!
 * Compressor.js v1.0.7
 * https://fengyuanchen.github.io/compressorjs
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2020-11-28T07:13:17.754Z
 */
"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function createCommonjsModule(fn,basedir,module){return fn(module={path:basedir,exports:{},require:function(path,base){return commonjsRequire(path,null==base?module.path:base)}},module.exports),module.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var canvasToBlob=createCommonjsModule((function(module){"undefined"!=typeof window&&function(window){var CanvasPrototype=window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype,hasBlobConstructor=window.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),hasArrayBufferViewSupport=hasBlobConstructor&&window.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,dataURIPattern=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,dataURLtoBlob=(hasBlobConstructor||BlobBuilder)&&window.atob&&window.ArrayBuffer&&window.Uint8Array&&function(dataURI){var matches,mediaType,isBase64,dataString,byteString,arrayBuffer,intArray,i,bb;if(!(matches=dataURI.match(dataURIPattern)))throw new Error("invalid data URI");for(mediaType=matches[2]?matches[1]:"text/plain"+(matches[3]||";charset=US-ASCII"),isBase64=!!matches[4],dataString=dataURI.slice(matches[0].length),byteString=isBase64?atob(dataString):decodeURIComponent(dataString),arrayBuffer=new ArrayBuffer(byteString.length),intArray=new Uint8Array(arrayBuffer),i=0;i<byteString.length;i+=1)intArray[i]=byteString.charCodeAt(i);return hasBlobConstructor?new Blob([hasArrayBufferViewSupport?intArray:arrayBuffer],{type:mediaType}):((bb=new BlobBuilder).append(arrayBuffer),bb.getBlob(mediaType))};window.HTMLCanvasElement&&!CanvasPrototype.toBlob&&(CanvasPrototype.mozGetAsFile?CanvasPrototype.toBlob=function(callback,type,quality){var self=this;setTimeout((function(){quality&&CanvasPrototype.toDataURL&&dataURLtoBlob?callback(dataURLtoBlob(self.toDataURL(type,quality))):callback(self.mozGetAsFile("blob",type))}))}:CanvasPrototype.toDataURL&&dataURLtoBlob&&(CanvasPrototype.msToBlob?CanvasPrototype.toBlob=function(callback,type,quality){var self=this;setTimeout((function(){(type&&"image/png"!==type||quality)&&CanvasPrototype.toDataURL&&dataURLtoBlob?callback(dataURLtoBlob(self.toDataURL(type,quality))):callback(self.msToBlob(type))}))}:CanvasPrototype.toBlob=function(callback,type,quality){var self=this;setTimeout((function(){callback(dataURLtoBlob(self.toDataURL(type,quality)))}))})),module.exports?module.exports=dataURLtoBlob:window.dataURLtoBlob=dataURLtoBlob}(window)})),isBlob=function isBlob(value){return"undefined"!=typeof Blob&&(value instanceof Blob||"[object Blob]"===Object.prototype.toString.call(value))},DEFAULTS={strict:!0,checkOrientation:!0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,quality:.8,mimeType:"auto",convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},IS_BROWSER="undefined"!=typeof window&&void 0!==window.document,WINDOW=IS_BROWSER?window:{},slice=Array.prototype.slice;function toArray(value){return Array.from?Array.from(value):slice.call(value)}var REGEXP_IMAGE_TYPE=/^image\/.+$/;function isImageType(value){return REGEXP_IMAGE_TYPE.test(value)}function imageTypeToExtension(value){var extension=isImageType(value)?value.substr(6):"";return"jpeg"===extension&&(extension="jpg"),".".concat(extension)}var fromCharCode=String.fromCharCode;function getStringFromCharCode(dataView,start,length){var str="",i;for(length+=start,i=start;i<length;i+=1)str+=fromCharCode(dataView.getUint8(i));return str}var btoa=WINDOW.btoa;function arrayBufferToDataURL(arrayBuffer,mimeType){for(var chunks=[],chunkSize=8192,uint8=new Uint8Array(arrayBuffer);uint8.length>0;)chunks.push(fromCharCode.apply(null,toArray(uint8.subarray(0,8192)))),uint8=uint8.subarray(8192);return"data:".concat(mimeType,";base64,").concat(btoa(chunks.join("")))}function resetAndGetOrientation(arrayBuffer){var dataView=new DataView(arrayBuffer),orientation;try{var littleEndian,app1Start,ifdStart;if(255===dataView.getUint8(0)&&216===dataView.getUint8(1))for(var length=dataView.byteLength,offset=2;offset+1<length;){if(255===dataView.getUint8(offset)&&225===dataView.getUint8(offset+1)){app1Start=offset;break}offset+=1}if(app1Start){var exifIDCode,tiffOffset=app1Start+10;if("Exif"===getStringFromCharCode(dataView,app1Start+4,4)){var endianness=dataView.getUint16(tiffOffset);if(((littleEndian=18761===endianness)||19789===endianness)&&42===dataView.getUint16(tiffOffset+2,littleEndian)){var firstIFDOffset=dataView.getUint32(tiffOffset+4,littleEndian);firstIFDOffset>=8&&(ifdStart=tiffOffset+firstIFDOffset)}}}if(ifdStart){var _length=dataView.getUint16(ifdStart,littleEndian),_offset,i;for(i=0;i<_length;i+=1)if(_offset=ifdStart+12*i+2,274===dataView.getUint16(_offset,littleEndian)){_offset+=8,orientation=dataView.getUint16(_offset,littleEndian),dataView.setUint16(_offset,1,littleEndian);break}}}catch(e){orientation=1}return orientation}function parseOrientation(orientation){var rotate=0,scaleX=1,scaleY=1;switch(orientation){case 2:scaleX=-1;break;case 3:rotate=-180;break;case 4:scaleY=-1;break;case 5:rotate=90,scaleY=-1;break;case 6:rotate=90;break;case 7:rotate=90,scaleX=-1;break;case 8:rotate=-90}return{rotate:rotate,scaleX:scaleX,scaleY:scaleY}}var REGEXP_DECIMALS=/\.\d*(?:0|9){12}\d*$/;function normalizeDecimalNumber(value){var times=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return REGEXP_DECIMALS.test(value)?Math.round(value*times)/times:value}var ArrayBuffer$1=WINDOW.ArrayBuffer,FileReader=WINDOW.FileReader,URL=WINDOW.URL||WINDOW.webkitURL,REGEXP_EXTENSION=/\.\w+$/,AnotherCompressor=WINDOW.Compressor,Compressor=function(){function Compressor(file,options){_classCallCheck(this,Compressor),this.file=file,this.image=new Image,this.options=_objectSpread2(_objectSpread2({},DEFAULTS),options),this.aborted=!1,this.result=null,this.init()}return _createClass(Compressor,[{key:"init",value:function init(){var _this=this,file=this.file,options=this.options;if(isBlob(file)){var mimeType=file.type;if(isImageType(mimeType))if(URL&&FileReader)if(ArrayBuffer$1||(options.checkOrientation=!1),URL&&!options.checkOrientation)this.load({url:URL.createObjectURL(file)});else{var reader=new FileReader,checkOrientation=options.checkOrientation&&"image/jpeg"===mimeType;this.reader=reader,reader.onload=function(_ref){var target,result=_ref.target.result,data={};if(checkOrientation){var orientation=resetAndGetOrientation(result);orientation>1||!URL?(data.url=arrayBufferToDataURL(result,mimeType),orientation>1&&_extends(data,parseOrientation(orientation))):data.url=URL.createObjectURL(file)}else data.url=result;_this.load(data)},reader.onabort=function(){_this.fail(new Error("Aborted to read the image with FileReader."))},reader.onerror=function(){_this.fail(new Error("Failed to read the image with FileReader."))},reader.onloadend=function(){_this.reader=null},checkOrientation?reader.readAsArrayBuffer(file):reader.readAsDataURL(file)}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function load(data){var _this2=this,file=this.file,image=this.image;image.onload=function(){_this2.draw(_objectSpread2(_objectSpread2({},data),{},{naturalWidth:image.naturalWidth,naturalHeight:image.naturalHeight}))},image.onabort=function(){_this2.fail(new Error("Aborted to load the image."))},image.onerror=function(){_this2.fail(new Error("Failed to load the image."))},WINDOW.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(WINDOW.navigator.userAgent)&&(image.crossOrigin="anonymous"),image.alt=file.name,image.src=data.url}},{key:"draw",value:function draw(_ref2){var _this3=this,naturalWidth=_ref2.naturalWidth,naturalHeight=_ref2.naturalHeight,_ref2$rotate=_ref2.rotate,rotate=void 0===_ref2$rotate?0:_ref2$rotate,_ref2$scaleX=_ref2.scaleX,scaleX=void 0===_ref2$scaleX?1:_ref2$scaleX,_ref2$scaleY=_ref2.scaleY,scaleY=void 0===_ref2$scaleY?1:_ref2$scaleY,file=this.file,image=this.image,options=this.options,canvas=document.createElement("canvas"),context=canvas.getContext("2d"),aspectRatio=naturalWidth/naturalHeight,is90DegreesRotated=Math.abs(rotate)%180==90,maxWidth=Math.max(options.maxWidth,0)||1/0,maxHeight=Math.max(options.maxHeight,0)||1/0,minWidth=Math.max(options.minWidth,0)||0,minHeight=Math.max(options.minHeight,0)||0,width=Math.max(options.width,0)||naturalWidth,height=Math.max(options.height,0)||naturalHeight;if(is90DegreesRotated){var _ref3=[maxHeight,maxWidth];maxWidth=_ref3[0],maxHeight=_ref3[1];var _ref4=[minHeight,minWidth];minWidth=_ref4[0],minHeight=_ref4[1];var _ref5=[height,width];width=_ref5[0],height=_ref5[1]}maxWidth<1/0&&maxHeight<1/0?maxHeight*aspectRatio>maxWidth?maxHeight=maxWidth/aspectRatio:maxWidth=maxHeight*aspectRatio:maxWidth<1/0?maxHeight=maxWidth/aspectRatio:maxHeight<1/0&&(maxWidth=maxHeight*aspectRatio),minWidth>0&&minHeight>0?minHeight*aspectRatio>minWidth?minHeight=minWidth/aspectRatio:minWidth=minHeight*aspectRatio:minWidth>0?minHeight=minWidth/aspectRatio:minHeight>0&&(minWidth=minHeight*aspectRatio),height*aspectRatio>width?height=width/aspectRatio:width=height*aspectRatio;var destX=-(width=Math.floor(normalizeDecimalNumber(Math.min(Math.max(width,minWidth),maxWidth))))/2,destY=-(height=Math.floor(normalizeDecimalNumber(Math.min(Math.max(height,minHeight),maxHeight))))/2,destWidth=width,destHeight=height;if(is90DegreesRotated){var _ref6=[height,width];width=_ref6[0],height=_ref6[1]}canvas.width=width,canvas.height=height,isImageType(options.mimeType)||(options.mimeType=file.type);var fillStyle="transparent";if(file.size>options.convertSize&&"image/png"===options.mimeType&&(fillStyle="#fff",options.mimeType="image/jpeg"),context.fillStyle=fillStyle,context.fillRect(0,0,width,height),options.beforeDraw&&options.beforeDraw.call(this,context,canvas),!this.aborted&&(context.save(),context.translate(width/2,height/2),context.rotate(rotate*Math.PI/180),context.scale(scaleX,scaleY),context.drawImage(image,destX,destY,destWidth,destHeight),context.restore(),options.drew&&options.drew.call(this,context,canvas),!this.aborted)){var done=function done(result){_this3.aborted||_this3.done({naturalWidth:naturalWidth,naturalHeight:naturalHeight,result:result})};canvas.toBlob?canvas.toBlob(done,options.mimeType,options.quality):done(canvasToBlob(canvas.toDataURL(options.mimeType,options.quality)))}}},{key:"done",value:function done(_ref7){var naturalWidth=_ref7.naturalWidth,naturalHeight=_ref7.naturalHeight,result=_ref7.result,file=this.file,image=this.image,options=this.options;if(URL&&!options.checkOrientation&&URL.revokeObjectURL(image.src),result)if(options.strict&&result.size>file.size&&options.mimeType===file.type&&!(options.width>naturalWidth||options.height>naturalHeight||options.minWidth>naturalWidth||options.minHeight>naturalHeight))result=file;else{var date=new Date;result.lastModified=date.getTime(),result.lastModifiedDate=date,result.name=file.name,result.name&&result.type!==file.type&&(result.name=result.name.replace(REGEXP_EXTENSION,imageTypeToExtension(result.type)))}else result=file;this.result=result,options.success&&options.success.call(this,result)}},{key:"fail",value:function fail(err){var options=this.options;if(!options.error)throw err;options.error.call(this,err)}},{key:"abort",value:function abort(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function noConflict(){return window.Compressor=AnotherCompressor,Compressor}},{key:"setDefaults",value:function setDefaults(options){_extends(DEFAULTS,options)}}]),Compressor}();module.exports=Compressor;