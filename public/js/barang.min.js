document.addEventListener("DOMContentLoaded",(function(event){const listBarangContainer=document.querySelector("div#list-barang-container"),listBarangEmptyText=listBarangContainer.querySelector("div#no-data"),listBarangLoading=listBarangContainer.querySelector("span#loading-list"),listGroupElement=listBarangContainer.querySelector("div.list-group"),dialogDataElement=document.querySelectorAll(".selected-data"),searchBox=document.querySelectorAll("input[type=search]");function countDataBarang(listParent){const angkaText=document.querySelector("#total-barang");angkaText.innerText=listParent.children.length.toString()}async function getListBarang(){try{listBarangLoading.classList.remove("d-none");const response=await fetch(`${BASEURL}/databarang/getListBarang`,{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"},cache:"default"});if(!response.ok)throw Error();const responseJson=await response.json();if(!responseJson)throw Error();0===Object.keys(responseJson).length?listBarangEmptyText.classList.replace("d-none","d-flex"):listBarangEmptyText.classList.replace("d-flex","d-none"),listBarangLoading.classList.add("d-none"),renderListBarang(responseJson),countDataBarang(listGroupElement);const listBarang=new List("list-barang",{valueNames:["nama","harga","stok"]})}catch(error){listBarangContainer.innerHTML='\n            <div class="d-none flex-column text-center align-items-center my-5" id="no-data">\n                <p class="display-4 text-secondary">Gagal mengambil data barang</p>\n                <p class="lead text-secondary font-weight-normal">Coba lagi nanti atau refresh halaman ini.</p>\n            </div>\n            '}}function renderListBarang(dataBarang){listGroupElement.innerHTML="",dataBarang.forEach(barang=>{listGroupElement.insertAdjacentHTML("beforeend",`\n            <div class="list-group-item">\n                <div class="row">\n                    <figure class="p-0 my-0 mx-2">\n                        <img src="resources/img/databarang/${barang.foto_barang}" class="img-thumbnail rounded-sm" alt="foto barang" onerror="this.onerror = null; this.src = 'resources/img/noimg.png'" style="object-fit: cover; height: 100px; width: 100px;">\n                    </figure>\n                    <div class="col-sm my-3 my-sm-0">\n                        <span class="d-flex w-100 justify-content-between">\n                            <h3 class="nama">${barang.nama_barang}</h3>\n                            <div class="dropdown p-0">\n                                <button class="btn text-primary p-1" data-toggle="dropdown" data-display="static" aria-haspopup="true" aria-expanded="false">\n                                    <svg class="bi" width="24" height="24" fill="currentColor">\n                                        <use xlink:href="${BASEURL}/img/bootstrap-icons-1.2.1/bootstrap-icons.svg#three-dots" />\n                                    </svg>\n                                </button>\n                                <div class="dropdown-menu dropdown-menu-right shadow">\n                                    <a href="${BASEURL}/databarang/pageedit/${barang.id_barang}" class="dropdown-item">Edit</a>\n                                    <a href="" class="dropdown-item text-danger" data-toggle="modal" data-target="#dialogHapus" data-id-barang="${barang.id_barang}" data-nama-barang="${barang.nama_barang}">Hapus</a>\n                                </div>\n                            </div>\n                        </span>\n                        <p class="font-weight-bold harga">Rp.${formatRupiah(barang.harga)}</p>\n                        <p class="text-muted my-0 stok">Stok: ${barang.stok}</p>\n                    </div>\n                </div>\n            </div>`)}),listGroupElement.querySelectorAll("a[data-toggle=modal]").forEach(btn=>{btn.addEventListener("click",(function(){dialogDataElement.forEach(element=>{"A"==element.tagName?element.setAttribute("href",`${BASEURL}/databarang/hapus/${btn.getAttribute("data-id-barang")}`):element.textContent=btn.getAttribute("data-nama-barang")})}))})}document.querySelector("a#btn-refresh").addEventListener("click",(function(){getListBarang()})),getListBarang()}));