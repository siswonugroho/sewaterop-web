document.addEventListener("DOMContentLoaded",(function(event){const listIsiPaket=document.querySelector(".list-barang"),inputPaketFlag=listIsiPaket.querySelector("#isi-paket-flag"),btnOpenModal=document.querySelector("a[data-toggle=modal]"),modalDialog=document.querySelector(".modal"),modalBody=modalDialog.querySelector(".modal-body"),modalFooter=modalBody.nextElementSibling,modalLoading=modalDialog.querySelector("#loading-list"),modalAlertError=modalFooter.querySelector(".alert"),modalInputJumlah=modalFooter.querySelector("input[type=number]");async function getListBarang(){try{modalLoading.classList.remove("d-none");const response=await fetch(`${BASEURL}/databarang/getListBarang`,{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(modalLoading.classList.add("d-none"),!response.ok)throw Error();const responseJson=await response.json();if(!responseJson)throw Error();renderListBarang(responseJson),0===Object.keys(responseJson).length&&(modalBody.innerHTML='<p class="text-center">Daftar barang kosong<br>Tambahkan beberapa barang terlebih dahulu di halaman Barang.</p>')}catch(error){modalBody.innerHTML=`<p class="text-center">Tidak dapat memuat daftar barang.<br>${error}</p>`,console.error(error)}}function renderListBarang(data){modalBody.innerHTML="",data.forEach(barang=>{modalBody.insertAdjacentHTML("beforeend",`<div class="custom-control custom-radio">\n    <input type="radio" id="${barang.id_barang}" name="item" value="${barang.nama_barang}" class="custom-control-input">\n    <label class="custom-control-label" for="${barang.id_barang}">\n        <h5 class="mb-1">${barang.nama_barang}</h5>\n        <p class="text-secondary">Stok: <span class='stok-barang'>${barang.stok}</span></p>\n    </label>\n</div>`)})}function removeBarangFromList(){listIsiPaket.querySelectorAll(".remove-btn").forEach(btn=>{btn.addEventListener("click",(function(){this.parentElement.remove(),validateListIsiPaket()}))})}function validateListIsiPaket(){0===listIsiPaket.querySelectorAll(".list-item").length?inputPaketFlag.value="":inputPaketFlag.value=1}modalFooter.querySelector("#tambahItem").addEventListener("click",(function(e){const radioBarang=modalBody.querySelectorAll("input[type=radio]");radioBarang.forEach(barang=>{if(barang.checked){const stokBarang=parseInt(barang.nextElementSibling.querySelector(".stok-barang").textContent);parseInt(modalInputJumlah.value)>stokBarang?(this.setAttribute("data-dismiss","none"),modalAlertError.classList.replace("d-none","show")):(this.setAttribute("data-dismiss","modal"),modalAlertError.classList.replace("show","d-none"),listIsiPaket.insertAdjacentHTML("beforeend",`<div class="input-group list-item">\n<input type="number" readonly name="paket[jumlah_barang][]" class="form-control bg-white jumlah" value="${modalInputJumlah.value}">\n<input type="hidden" name="paket[id_barang][]" class="form-control bg-white jumlah" value="${barang.getAttribute("id")}">\n<input type="text" readonly name="paket[nama_barang][]" class="form-control bg-white w-50 nama" value="${barang.value}">\n<div class="input-group-append remove-btn">\n    <a href="javascript:void(0)" class="text-decoration-none input-group-text">&times;</a>\n</div>\n</div>`))}}),validateListIsiPaket(),removeBarangFromList()})),btnOpenModal.addEventListener("click",(function(){getListBarang()})),$(modalDialog).on("hidden.bs.modal",(function(e){modalAlertError.classList.replace("show","d-none"),modalInputJumlah.value=0})),validateListIsiPaket(),removeBarangFromList()}));