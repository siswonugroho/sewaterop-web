document.addEventListener("DOMContentLoaded",(function(event){const listBarangContainer=document.querySelector("div#list-barang-container"),listBarangLoading=listBarangContainer.querySelector("span#loading-list"),listBarangEmptyMessage=listBarangContainer.querySelector(".list-barang-empty-message"),listGroupElement=listBarangContainer.querySelector("div.list"),dialogDataElement=document.querySelectorAll(".selected-data");function countDataBarang(listParent){const angkaText=document.querySelector("#total-barang");angkaText.innerText=listParent.children.length.toString()}async function getListBarang(){try{listBarangLoading.classList.remove("d-none");const response=await fetch(`${BASEURL}/databarang/getListBarang`,{method:"GET"});if(listBarangLoading.classList.add("d-none"),!response.ok)throw Error();const responseJson=await response.json();if(!responseJson)throw Error();if(renderListBarang(responseJson),countDataBarang(listGroupElement),0!==Object.keys(responseJson).length){toggleListEmpty("hide");const listBarang=new List("list-barang",{valueNames:["nama","harga","stok","last-added"]});listBarang.sort("last-added",{order:"desc"}),listBarang.on("searchComplete",(function(){0===listBarang.matchingItems.length?toggleListEmpty("show","search","Hasil pencarian tidak ditemukan","Coba masukkan kata kunci lain yang lebih umum."):toggleListEmpty("hide")}))}else toggleListEmpty("show","emoji-frown","Tidak ada barang disini","Tambahkan informasi barang yang Anda sewakan dengan mengklik Tambah.")}catch(error){listBarangLoading.classList.add("d-none"),toggleListEmpty("show","x-circle","Gagal memuat daftar barang","Coba lagi nanti atau refresh halaman ini."),console.error(error)}}function renderListBarang(dataBarang){listGroupElement.innerHTML="",dataBarang.forEach(barang=>{listGroupElement.insertAdjacentHTML("beforeend",`\n<div class="col px-0">\n    <div class="card m-2 shadow-sm border-0 anim-fade">\n        <img src="${BASEURL}/assets/resources/img/databarang/${barang.foto_barang}" class="card-img-top" alt="foto barang" onerror="this.onerror = null; this.src = '${BASEURL}/assets/resources/img/noimg.png'" style="object-fit: cover; height: 10em; width: 100%;">\n        <div class="card-body">\n            <span class="d-flex w-100 justify-content-between">\n                <h5 class="nama text-truncate">${barang.nama_barang}</h5>\n                <div class="dropdown p-0">\n                    <button class="btn text-primary p-1" data-toggle="dropdown" data-display="static" aria-haspopup="true" aria-expanded="false">\n                        <svg class="bi" width="24" height="24" fill="currentColor">\n                            <use href="${BASEURL}/assets/img/bootstrap-icons-1.2.1/bootstrap-icons.svg#three-dots" />\n                        </svg>\n                    </button>\n                    <div class="dropdown-menu dropdown-menu-right anim-fade shadow">\n                        <a href="${BASEURL}/databarang/pageedit/${barang.id_barang}" class="dropdown-item">Edit</a>\n                        <a href="" class="dropdown-item text-danger" data-toggle="modal" data-target="#dialogHapus" data-id-barang="${barang.id_barang}" data-nama-barang="${barang.nama_barang}">Hapus</a>\n                    </div>\n                </div>\n            </span>\n            <p class="font-weight-bold">Rp.${formatRupiah(barang.harga)}</p>\n            <p class="d-none harga">Rp.${barang.harga}</p>\n            <p class="d-none last-added">Rp.${barang.id_barang}</p>\n            <p class="text-muted my-0 stok">Stok: ${barang.stok}</p>\n        </div>\n    </div>\n</div>`)}),listGroupElement.querySelectorAll("a[data-toggle=modal]").forEach(btn=>{btn.addEventListener("click",(function(){dialogDataElement.forEach(element=>{"A"==element.tagName?element.setAttribute("href",`${BASEURL}/databarang/hapus/${btn.getAttribute("data-id-barang")}`):element.textContent=btn.getAttribute("data-nama-barang")})}))})}function toggleListEmpty(toggle,iconName="",messageTitle="",messageDetail=""){switch(toggle){case"show":listBarangEmptyMessage.classList.replace("d-none","d-flex"),listBarangEmptyMessage.children[0].querySelector("use").setAttribute("href",`${BASEURL}/assets/img/bootstrap-icons-1.2.1/bootstrap-icons.svg#${iconName}`),listBarangEmptyMessage.children[1].textContent=messageTitle,listBarangEmptyMessage.children[2].textContent=messageDetail;break;case"hide":listBarangEmptyMessage.classList.replace("d-flex","d-none")}}document.querySelector("a#btn-refresh").addEventListener("click",(function(){getListBarang()})),getListBarang()}));