document.addEventListener("DOMContentLoaded",(function(event){const listPenyewaContainer=document.querySelector("div#list-penyewa-container"),listPenyewaLoading=listPenyewaContainer.querySelector("span#loading-list"),listPenyewaEmptyMessage=listPenyewaContainer.querySelector(".list-penyewa-empty-message"),listGroupElement=listPenyewaContainer.querySelector("div.list-group"),dialogDataElement=document.querySelectorAll(".selected-data");function countDataPenyewa(listParent){const angkaText=document.querySelector("#total-penyewa");angkaText.innerText=listParent.children.length.toString()}async function getListPenyewa(){try{listPenyewaLoading.classList.remove("d-none");const response=await fetch(`${BASEURL}/datapenyewa/getListPenyewa`,{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"},cache:"default"});if(listPenyewaLoading.classList.add("d-none"),!response.ok)throw Error();const responseJson=await response.json();if(!responseJson)throw Error();if(renderListPenyewa(responseJson),countDataPenyewa(listGroupElement),0!==Object.keys(responseJson).length){toggleListEmpty("hide");const listPenyewa=new List("list-penyewa",{valueNames:["nama","alamat","username","last-added"]});listPenyewa.sort("last-added",{order:"desc"}),listPenyewa.on("searchComplete",(function(){0===listPenyewa.matchingItems.length?toggleListEmpty("show","search","Hasil pencarian tidak ditemukan","Coba masukkan kata kunci lain yang lebih umum."):toggleListEmpty("hide")}))}else toggleListEmpty("show","emoji-frown","Tidak ada penyewa disini","Sebelum membuat pesanan, tambahkan penyewa terlebih dahulu")}catch(error){listPenyewaLoading.classList.add("d-none"),toggleListEmpty("show","x-circle","Gagal memuat daftar penyewa","Coba lagi nanti atau refresh halaman ini."),console.error(error)}}function renderListPenyewa(dataPenyewa){listGroupElement.innerHTML="",dataPenyewa.forEach(penyewa=>{listGroupElement.insertAdjacentHTML("beforeend",`\n<div class="list-group-item anim-fade">\n    <span class="d-flex w-100 justify-content-between">\n        <h5 class="nama">${penyewa.nama_pemesan}</h5>\n        <div class="dropdown p-0">\n            <button class="btn text-primary p-1" data-toggle="dropdown" data-display="static" aria-haspopup="true" aria-expanded="false">\n                <svg class="bi" width="24" height="24" fill="currentColor">\n                    <use href="${BASEURL}/assets/img/bootstrap-icons-1.2.1/bootstrap-icons.svg#three-dots" />\n                </svg>\n            </button>\n            <div class="dropdown-menu dropdown-menu-right anim-fade shadow">\n                <a href="${BASEURL}/datapenyewa/pageedit/${penyewa.id_pemesan}" class="dropdown-item">Edit</a>\n                <a href="" class="dropdown-item text-danger" data-toggle="modal" data-target="#dialogHapus" data-id-penyewa="${penyewa.id_pemesan}" data-nama-penyewa="${penyewa.nama_pemesan}">Hapus</a>\n            </div>\n        </div>\n    </span>\n    <p class="text-muted my-0 username">@${penyewa.username} â€¢ ${penyewa.telepon}</p>\n    <p class="text-muted my-0 alamat">${penyewa.alamat}</p>\n    <p class="d-none last-added">${penyewa.id_pemesan}</p>\n</div>`)}),listGroupElement.querySelectorAll("a[data-toggle=modal]").forEach(btn=>{btn.addEventListener("click",(function(){dialogDataElement.forEach(element=>{"A"==element.tagName?element.setAttribute("href",`${BASEURL}/datapenyewa/hapus/${btn.getAttribute("data-id-penyewa")}`):element.textContent=btn.getAttribute("data-nama-penyewa")})}))})}function toggleListEmpty(toggle,iconName="",messageTitle="",messageDetail=""){switch(toggle){case"show":listPenyewaEmptyMessage.classList.replace("d-none","d-flex"),listPenyewaEmptyMessage.children[0].querySelector("use").setAttribute("href",`${BASEURL}/assets/img/bootstrap-icons-1.2.1/bootstrap-icons.svg#${iconName}`),listPenyewaEmptyMessage.children[1].textContent=messageTitle,listPenyewaEmptyMessage.children[2].textContent=messageDetail;break;case"hide":listPenyewaEmptyMessage.classList.replace("d-flex","d-none")}}document.querySelector("a#btn-refresh").addEventListener("click",(function(){getListPenyewa()})),getListPenyewa()}));